{% load humanize %}
<!doctype html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <title>سفارش {{ order.id }}</title>
  </head>
  <body>
    <a href="{% url 'catalog:product_list' %}">بازگشت به محصولات</a>

    <h1>سفارش</h1>
    <p><strong>شناسه:</strong> {{ order.id }}</p>
    <p><strong>وضعیت:</strong> {{ order.status }}</p>

    <h2>آیتم‌ها</h2>
    {% if items %}
      <ul>
        {% for item in items %}
          <li>
            {{ item.product.title }} —
            تعداد: {{ item.quantity }} —
            قیمت واحد: {{ item.unit_price_irr|intcomma }} ریال —
            جمع: {{ item.line_total_irr|intcomma }} ریال
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>این سفارش آیتمی ندارد.</p>
    {% endif %}

    <hr />
    <p><strong>جمع کل:</strong> {{ computed_total|intcomma }} ریال</p>
    <hr />
<p><strong>جمع کل:</strong> {{ computed_total|intcomma }} ریال</p>

{% if order.payment_provider %}
  <p><strong>درگاه:</strong> {{ order.payment_provider }}</p>
{% endif %}
{% if order.payment_session_id %}
  <p><strong>Authority:</strong> {{ order.payment_session_id }}</p>
{% endif %}
{% if order.payment_ref_id %}
  <p><strong>RefID:</strong> {{ order.payment_ref_id }}</p>
{% endif %}
{% if order.paid_at %}
  <p><strong>زمان پرداخت:</strong> {{ order.paid_at }}</p>
{% endif %}

{% if order.status == "PENDING_PAYMENT" %}
  <form method="post" action="{% url 'payments:start' order_id=order.id %}">
    {% csrf_token %}
    <button type="submit">پرداخت</button>
  </form>
{% else %}
  <p>این سفارش در وضعیت «{{ order.status }}» است و پرداخت فعال نیست.</p>
{% endif %}

    <form method="post" action="{% url 'payments:start' order_id=order.id %}">
    {% csrf_token %}
    <button type="submit">پرداخت</button>
    </form>
    <p>(پرداخت هنوز فعال نشده — مرحله بعدی)</p>
  </body>
</html>
